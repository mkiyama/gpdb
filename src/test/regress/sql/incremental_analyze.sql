-- start_ignore
DROP DATABASE IF EXISTS incrementalanalyze;
CREATE DATABASE incrementalanalyze;
ALTER DATABASE incrementalanalyze SET lc_monetary TO 'C';
\c incrementalanalyze
DROP SCHEMA IF EXISTS incremental_analyze;
CREATE SCHEMA incremental_analyze;
-- end_ignore
-- Test ANALYZE for different data types
-- Case 1: Partitions have MCVs but after merge, none of the partition MCVs 
-- qualify as a global MCV for the root and they are used to create the
-- root histogram
DROP TABLE IF EXISTS foo;
SET default_statistics_target = 4;
CREATE TYPE inc_analyze_composite AS
(
    a numeric,
    b numeric
);
CREATE TABLE foo (
    a int,
    b int, 
    c03_bigint bigint, 
    c04_bigserial bigserial, 
    c05_bit bit, 
    c06_bit_varying_10 bit varying(10), 
    c07_bool bool, 
    c08_char char, 
    c09_varchar_10 varchar(10), 
    c10_cidr cidr, 
    c11_date date, 
    c12_numeric_8_2 numeric(8,2), 
    c13_float8 float8, 
    c14_inet inet, 
    c15_int4 int4, 
    c16_interval interval, 
    c17_macaddr macaddr, 
    c18_money money, 
    c19_float4 float4, 
    c20_serial4 serial4, 
    c21_smallint smallint, 
    c22_text text, 
    c23_time time, 
    c24_timetz timetz, 
    c25_timestamp timestamp, 
    c26_timestamptz timestamptz,
    c27_uuid uuid,
    c28_tsquery tsquery,
    c29_varchararray character varying(2)[],
    c30_intarray int[],
    c31_bigintarray bigint[],
    c33_bitarray bit(1)[],
    c34_bitvaryingarray bit varying(10)[],
    c35_boolarray boolean[],
    c36_chararray character(1)[],
    c37_cidrarray cidr[],
    c38_datearray date[],
    c39_numericarray numeric[],
    c40_float8array double precision[],
    c41_inetarray inet[],
    c42_int4array integer[],
    c43_intervalarray interval[],
    c44_macaddrarray macaddr[],
    c45_moneyarray money[],
    c46_float4array real[],
    c47_smallintarrayn smallint[],
    c48_textarray text[],
    c49_timearray time without time zone[],
    c50_timetzarray time with time zone[],
    c51_timestamparray timestamp without time zone[],
    c52_timestamptzarray timestamp with time zone[],
    c53_uuidzarray uuid[],
    c54_tsqueryarray tsquery[],
    c55_jsonarray json[],
    c56_xmlarray xml[],
    c57_pointarray point[],
    c58_linesegarray lseg[],
    c59_patharray path[],
    c60_boxarray box[],
    c61_polygonarray polygon[],
    c62_circlearray circle[],
    c63_inc_analyze_composite_array inc_analyze_composite[]
) PARTITION BY RANGE (b) (START (0) END(6) EVERY(3));
CREATE TYPE input_fields AS
(
    varchararray character varying(2)[],
    intarray int[],
    _bigintarray bigint[],
    bitarray bit(1)[],
    bitvaryingarray bit varying(10)[],
    boolarray boolean[],
    chararray character(1)[],
    cidrarray cidr[],
    datearray date[],
    numericarray numeric[],
    float8array double precision[],
    inetarray inet[],
    int4array integer[],
    intervalarray interval[],
    macaddrarray macaddr[],
    moneyarray money[],
    float4array real[],
    smallintarrayn smallint[],
    textarray text[],
    timearray time without time zone[],
    timetzarray time with time zone[],
    timestamparray timestamp without time zone[],
    timestamptzarray timestamp with time zone[],
    uuidzarray uuid[],
    tsqueryarray tsquery[],
    jsonarray json[],
    xmlarray xml[],
    pointarray point[],
    linesegarray lseg[],
    patharray path[],
    boxarray box[],
    polygonarray polygon[],
    circlearray circle[],
    inc_analyze_composite_array inc_analyze_composite[]
);

CREATE OR REPLACE FUNCTION get_input_fields(i INT) RETURNS input_fields AS $$
DECLARE
    fields input_fields;
BEGIN
    SELECT
        ARRAY['a' || (i % 6), 'b' || (i % 6)]::character varying(2)[],
        ARRAY[i, i % 6]::int[],
        ARRAY[(i % 6), ((i + 1) % 6)]::bigint[],
        ARRAY[i, (i + 1)]::bit[],
        ARRAY[(i % 6)::bit(10), ((i + 1) % 6)::bit(10)]::bit varying(10)[],
        ARRAY[(i % 2), ((i + 1) % 2)]::bool[],
        ARRAY['a' || i, 'b' || i]::char[],
        ARRAY['192.168.100.' || (i % 6), '192.168.101.' || (i % 6)]::cidr[],
        ARRAY['2018-01-' || ((i % 6) + 1), '2018-01-' || ((i % 6) + 1)]::date[],
        ARRAY[(i % 6), ((i + 1) % 6)]::numeric[],
        ARRAY[(i % 6), ((i + 1) % 6)]::float8[],
        ARRAY['192.168.100.' || (i % 6), '192.168.100.' || ((i + 1) % 6)]::inet[],
        ARRAY[(i % 6), ((i + 1) % 6)]::int4[],
        '{"1 hour", "1 hour"}'::interval[],
        ARRAY['08:00:2b:01:02:' || (i % 6), '08:00:2b:01:02:' || (i % 6)]::macaddr[],
        ARRAY['123.4', '234.5']::money[],
        ARRAY[(i % 6), ((i + 1) % 6)]::float4[],
        ARRAY[(i % 6), ((i + 1) % 6)]::smallint[],
        ARRAY['abcd' || (i % 6), 'def' || ((i + 1) % 6)]::text[],
        ARRAY[(i % 6) || ':00:00', ((i + 1) % 6) || ':00:00']::time[],
        ARRAY[(i % 6) || ':00:59 PST', ((i + 1) % 6) || ':00:59 EST']::timetz[],
        ARRAY['2018-01-01 ' || (i % 6) || ':59:00', '2018-01-01 ' || ((i + 1) % 6) || ':59:00']::timestamp[],
        ARRAY['2018-01-01 ' || (i % 6) || ':59:00 PST', '2018-01-01 ' || ((i + 1) % 6) || ':59:00 EST']::timestamptz[],
        ARRAY['11111111-1111-1111-1111-1111111111' || (i % 6) || (i % 6), '11111111-1111-1111-1111-1111111111' || ((i + 1) % 6) || ((i + 1) % 6)]::uuid[],
        ARRAY['foo' || (i % 6) || ' & rat', 'rat' || (i % 6) || ' & foo']::tsquery[],
        ARRAY['{"a": "b"}', '{"c": "d"}']::json[],
        ARRAY['<a></a>', '<b></b>']::xml[],
        ARRAY[point(i, i + 1), point(i + 2, i + 3)],
        ARRAY[lseg(point(i, i + 1), point(i + 2, i + 3)), lseg(point(i + 4, i + 5), point(i + 6, i + 7))],
        ARRAY[path(polygon(box(point(i + 1, i + 2), point(i + 3, i + 4)))), path(polygon(box(point(i + 1, i + 2), point(i + 3, i + 4))))],
        ARRAY[box(point(i + 1, i + 2), point(i + 3, i + 4)), box(point(i + 1, i + 2), point(i + 3, i + 4))],
        ARRAY[polygon(box(point(i + 1, i + 2), point(i + 3, i + 4))), polygon(box(point(i + 1, i + 2), point(i + 3, i + 4)))], 
        ARRAY[circle(point(i + 1, i + 2), i + 3), circle(point(i + 4, i + 5), i + 6)],
        ARRAY[ROW(i % 6, (i + 1) % 6), ROW(i % 6, (i + 1) % 6)]::inc_analyze_composite[]
    INTO fields;

    RETURN fields;
END;
$$ LANGUAGE PLPGSQL;
INSERT INTO foo
SELECT
i,
i%6,
i%6::bigint,
i%6,
i::bit,
(i%6)::bit(10)::bit varying(10),
(i%2)::bool,
(i%6)::char,
('a'||(i%6))::varchar(10),
('192.168.100.'||(i%6))::cidr, 
('2018-4-'||(i%6)+1)::date, 
(i%6)::numeric(8,2), 
(i%6)::float8,
inet ('192.168.100.'||(i%6)),
i%6::int4,
interval '24 hours',
macaddr ('12:34:56:78:90:'||(i%6)::text)::text::macaddr,
(i%6)::text::money,
(i%6)::float4, 
i%6,
i%6,
'aa'||(i%6)::text,
((i%6)::text||':59:59')::time,
((i%6)::text||':59:00 EST')::timetz,
('2018-01-01 '||(i%6)::text||':59:00')::timestamp,
('2018-01-01 '||(i%6)::text||':59:00 EST')::timestamptz,
('11111111-1111-1111-1111-1111111111'||(i%6)::text||(i%6)::text)::uuid,
('foo'||(i%6)::text||' & rat'||(i%6)::text)::tsquery,
(get_input_fields(i)).*
FROM generate_series(1,100) i;
ANALYZE foo;
SELECT tablename, attname, null_frac, n_distinct, most_common_vals, most_common_freqs, histogram_bounds FROM pg_stats WHERE tablename like 'foo%' and attname != 'a' ORDER BY attname,tablename;
-- Case 2: Partitions have no MCVs, only histograms, after merge root has to
-- have approximately merged histograms.
TRUNCATE foo;
INSERT INTO foo 
SELECT
i,
i%3,
i::bigint,
i,
i::bit,
(i)::bit(10)::bit varying(10),
(i)::bool,
(i)::char,
('a'||(i))::varchar(10),
('192.168.100.'||(i%128))::cidr, 
('2018-4-'||(i%15)+1)::date, 
(i)::numeric(8,2), 
(i)::float8,
inet ('192.168.100.'||(i%128)),
i::int4,
interval '24 hours',
macaddr ('12:34:56:78:90:'||(i%50)::text)::text::macaddr,
(i)::text::money,
(i)::float4, 
i,
i,
'aa'||(i)::text,
((i%12)::text||':59:59')::time,
((i%12)::text||':59:00 EST')::timetz,
('2018-01-01 '||(i%12)::text||':59:00')::timestamp,
('2018-01-01 '||(i%12)::text||':59:00 EST')::timestamptz,
('11111111-1111-1111-1111-1111111111'||(i%5)::text||(i%5)::text)::uuid,
('foo'||(i)::text||' & rat'||(i)::text)::tsquery,
(get_input_fields(i)).*
FROM generate_series(1,100) i;
INSERT INTO foo 
SELECT
i,
i%3,
i+200::bigint,
i+200,
i::bit,
(i+200)::bit(10)::bit varying(10),
(i+200)::bool,
(i+200)::char,
('a'||(i+200))::varchar(10),
('192.168.100.'||(i%128+128))::cidr, 
('2018-4-'||(i%15+16))::date, 
(i)::numeric(8,2),
(i)::float8,
inet ('192.168.100.'||(i%128+128)),
i::int4,
interval '24 hours',
macaddr ('12:34:56:78:90:'||(i%50+50)::text)::text::macaddr,
(i)::text::money,
(i)::float4,
i,
i,
'aa'||(i)::text,
((i%12+12)::text||':59:59')::time,
((i%12+12)::text||':59:00 EST')::timetz,
('2018-01-01 '||(i%12+12)::text||':59:00')::timestamp,
('2018-01-01 '||(i%12+12)::text||':59:00 EST')::timestamptz,
('11111111-1111-1111-1111-1111111111'||(i%5+5)::text||(i%5+5)::text)::uuid,
('foo'||(i+200)::text||' & rat'||(i+200)::text)::tsquery,
(get_input_fields(i)).*
FROM generate_series(1,100) i;
INSERT INTO foo 
SELECT
i,
i%3+3,
i::bigint,
i,
i::bit,
(i)::bit(10)::bit varying(10),
(i)::bool,
(i)::char,
('a'||(i))::varchar(10),
('192.168.100.'||(i%128))::cidr, 
('2018-4-'||(i%15)+1)::date, 
(i)::numeric(8,2), 
(i)::float8,
inet ('192.168.100.'||(i%128)),
i::int4,
interval '24 hours',
macaddr ('12:34:56:78:90:'||(i%50)::text)::text::macaddr,
(i)::text::money,
(i)::float4, 
i,
i,
'aa'||(i)::text,
((i%12)::text||':59:59')::time,
((i%12)::text||':59:00 EST')::timetz,
('2018-01-01 '||(i%12)::text||':59:00')::timestamp,
('2018-01-01 '||(i%12)::text||':59:00 EST')::timestamptz,
('11111111-1111-1111-1111-1111111111'||(i%5)::text||(i%5)::text)::uuid,
('foo'||(i)::text||' & rat'||(i)::text)::tsquery,
(get_input_fields(i)).*
FROM generate_series(1,200) i;
ANALYZE foo;
SELECT tablename, attname, null_frac, n_distinct, most_common_vals, most_common_freqs, histogram_bounds FROM pg_stats WHERE tablename like 'foo%' ORDER BY attname,tablename;
-- Case 3: Partitions have MCVs but after merge, MCVs that do not qualify as 
-- global MCV for the root will be used to create root histograms
TRUNCATE foo;
INSERT INTO foo 
SELECT
i,
i%3,
i%4::bigint,
i%4,
i::bit,
(i%4)::bit(10)::bit varying(10),
(i)::bool,
(i%4)::char,
('a'||(i%4))::varchar(10),
('192.168.100.'||(i%4))::cidr, 
('2018-4-'||(i%4)+1)::date, 
(i%4)::numeric(8,2), 
(i%4)::float8,
inet ('192.168.100.'||(i%4)),
i%4::int4,
interval '24 hours',
macaddr ('12:34:56:78:90:'||(i%4)::text)::text::macaddr,
(i%4)::text::money,
(i%4)::float4, 
i%4,
i%4,
'aa'||(i%4)::text,
('12:'||(i%4)::text||':00')::time,
('12:'||(i%4)::text||':00 EST')::timetz,
('2018-01-01 '||'12:'||(i%4)::text||':00')::timestamp,
('2018-01-01 '||'12:'||(i%4)::text||':00 EST')::timestamptz,
('11111111-1111-1111-1111-1111111111'||(i%4)::text||(i%4)::text)::uuid,
('foo'||(i%4)::text||' & rat'||(i%4)::text)::tsquery,
(get_input_fields(i)).*
FROM generate_series(1,100) i;
INSERT INTO foo 
SELECT
i,
i%3+3,
i::bigint,
i,
i::bit,
(i)::bit(10)::bit varying(10),
(i)::bool,
(i)::char,
('a'||(i))::varchar(10),
('192.168.100.'||(i))::cidr, 
('2018-4-'||(i%26+1))::date, 
(i)::numeric(8,2),
(i)::float8,
inet ('192.168.100.'||(i)),
i::int4,
interval '24 hours',
macaddr ('12:34:56:78:90:'||(i)::text)::text::macaddr,
(i)::text::money,
(i)::float4,
i,
i,
'aa'||(i)::text,
('12:'||(i%60)::text||':00')::time,
('12:'||(i%60)::text||':00 EST')::timetz,
('2018-01-01 '||'12:'||(i%60)::text||':00')::timestamp,
('2018-01-01 '||'12:'||(i%60)::text||':00 EST')::timestamptz,
('11111111-1111-1111-1111-1111111111'||(i%6)::text||(i%6)::text)::uuid,
('foo'||(i)::text||' & rat'||(i)::text)::tsquery,
(get_input_fields(i)).*
FROM generate_series(1,60) i;
INSERT INTO foo 
SELECT
i,
i%3+3,
i%4+61::bigint,
i%4+61,
(i%4+61)::bit,
(i%4+61)::bit(10)::bit varying(10),
(i%4+61)::bool,
(i%4+61)::char,
('a'||(i%4+61))::varchar(10),
('192.168.100.'||(i%4+61))::cidr, 
('2018-4-'||(i%4)+27)::date, 
(i%4+61)::numeric(8,2), 
(i%4+61)::float8,
inet ('192.168.100.'||(i%4+61)),
i%4+61::int4,
interval '24 hours',
macaddr ('12:34:56:78:90:'||(i%4+61)::text)::text::macaddr,
(i%4+61)::text::money,
(i%4+61)::float4, 
i%4+61,
i%4+61,
'aa'||(i%4+61)::text,
('12:59:'||(i%4+10)::text)::time,
('12:59:'||(i%4+10)::text||' EST')::timetz,
('2018-01-01 '||'12:59:'||(i%4+10)::text)::timestamp,
('2018-01-01 '||'12:59:'||(i%4+10)::text||' EST')::timestamptz,
('11111111-1111-1111-1111-1111111111'||(i%4+6)::text||(i%4+6)::text)::uuid,
('foo'||(i%4)::text||' & rat'||(i%4)::text)::tsquery,
(get_input_fields(i)).*
FROM generate_series(1,40) i;
ANALYZE foo;
SELECT tablename, attname, null_frac, n_distinct, most_common_vals, most_common_freqs, histogram_bounds FROM pg_stats WHERE tablename like 'foo%' ORDER BY attname,tablename;
-- Case 4: A partition has MCVs but after merge, those MCVs do not qualify as 
-- global MCV for the root will be used to create root histograms
TRUNCATE foo;
INSERT INTO foo 
SELECT
i,
i%3,
i::bigint,
i,
i::bit,
(i)::bit(10)::bit varying(10),
(i)::bool,
(i)::char,
('a'||(i))::varchar(10),
('192.168.100.'||(i%128))::cidr, 
('2018-4-'||(i%15)+1)::date, 
(i)::numeric(8,2), 
(i)::float8,
inet ('192.168.100.'||(i%128)),
i::int4,
interval '24 hours',
macaddr ('12:34:56:78:90:'||(i%50)::text)::text::macaddr,
(i)::text::money,
(i)::float4, 
i,
i,
'aa'||(i)::text,
((i%12)::text||':59:59')::time,
((i%12)::text||':59:00 EST')::timetz,
('2018-01-01 '||(i%12)::text||':59:00')::timestamp,
('2018-01-01 '||(i%12)::text||':59:00 EST')::timestamptz,
('11111111-1111-1111-1111-1111111111'||(i%5)::text||(i%5)::text)::uuid,
('foo'||(i)::text||' & rat'||(i)::text)::tsquery,
(get_input_fields(i)).*
FROM generate_series(1,100) i;
INSERT INTO foo 
SELECT
i,
i%3+3,
i%4+61::bigint,
i%4+61,
(i%4+61)::bit,
(i%4+61)::bit(10)::bit varying(10),
(i%4+61)::bool,
(i%4+61)::char,
('a'||(i%4+61))::varchar(10),
('192.168.100.'||(i%4+61))::cidr, 
('2018-4-'||(i%4+26))::date, 
(i%4+61)::numeric(8,2),
(i%4+61)::float8,
inet ('192.168.100.'||(i%4+61)),
i%4+61::int4,
interval '24 hours',
macaddr ('12:34:56:78:90:'||(i%4+61)::text)::text::macaddr,
(i%4+61)::text::money,
(i%4+61)::float4,
i%4+61,
i%4+61,
'aa'||(i%4+61)::text,
('12:'||(i%4+56)::text||':00')::time,
('12:'||(i%4+56)::text||':00 EST')::timetz,
('2018-01-01 '||'12:'||(i%4+56)::text||':00')::timestamp,
('2018-01-01 '||'12:'||(i%4+56)::text||':00 EST')::timestamptz,
('11111111-1111-1111-1111-1111111111'||(i%4+6)::text||(i%4+6)::text)::uuid,
('foo'||(i%4+61)::text||' & rat'||(i%4+61)::text)::tsquery,
(get_input_fields(i)).*
FROM generate_series(1,8) i;
INSERT INTO foo 
SELECT
i,
i%3+3,
i::bigint,
i,
i::bit,
(i)::bit(10)::bit varying(10),
(i)::bool,
(i)::char,
('a'||(i))::varchar(10),
('192.168.100.'||(i))::cidr, 
('2018-4-'||(i%25+1))::date, 
(i)::numeric(8,2),
(i)::float8,
inet ('192.168.100.'||(i)),
i::int4,
interval '24 hours',
macaddr ('12:34:56:78:90:'||(i)::text)::text::macaddr,
(i)::text::money,
(i)::float4,
i,
i,
'aa'||(i)::text,
('12:00:'||(i%60)::text)::time,
('12:00:'||(i%60)::text||' EST')::timetz,
('2018-01-01 '||'12:00'||(i%60)::text)::timestamp,
('2018-01-01 '||'12:00'||(i%60)::text||' EST')::timestamptz,
('11111111-1111-1111-1111-1111111111'||(i%10)::text||(i%10)::text)::uuid,
('foo'||(i)::text||' & rat'||(i)::text)::tsquery,
(get_input_fields(i)).*
FROM generate_series(1,60) i;
ANALYZE foo;
SELECT tablename, attname, null_frac, n_distinct, most_common_vals, most_common_freqs, histogram_bounds FROM pg_stats WHERE tablename like 'foo%' and attname != 'a' ORDER BY attname,tablename;
-- Case 5: A partition has MCVs but after merge, those MCVs qualify as global
-- MCVs for the root
TRUNCATE foo;
INSERT INTO foo 
SELECT
i,
i%3,
i::bigint,
i,
i::bit,
(i)::bit(10)::bit varying(10),
(i)::bool,
(i)::char,
('a'||(i))::varchar(10),
('192.168.100.'||(i%128))::cidr, 
('2018-'||(i%12)+1||'-'||(i%15)+1)::date,
(i)::numeric(8,2), 
(i)::float8,
inet ('192.168.100.'||(i%128)),
i::int4,
interval '24 hours',
macaddr ('12:34:56:78:90:'||(i%50)::text)::text::macaddr,
(i)::text::money,
(i)::float4, 
i,
i,
'aa'||(i)::text,
('12:'||(i%60)::text||':'||(i%30)::text)::time,
('12:'||(i%60)::text||':'||(i%30)::text||' EST')::timetz,
('2018-01-01 '||'12:'||(i%60)::text||':'||(i%30)::text)::timestamp,
('2018-01-01 '||'12:'||(i%60)::text||':'||(i%30)::text||' EST')::timestamptz,
('11111111-1111-1111-1111-1111111111'||(i%5)::text||(i%5)::text)::uuid,
('foo'||(i)::text||' & rat'||(i)::text)::tsquery,
(get_input_fields(i)).*
FROM generate_series(1,60) i;
INSERT INTO foo 
SELECT
i,
i%3+3,
i%4+61::bigint,
i%4+61,
(i%4+61)::bit,
(i%4+61)::bit(10)::bit varying(10),
(i%4+61)::bool,
(i%4+61)::char,
('a'||(i%4+61))::varchar(10),
('192.168.100.'||(i%4+61))::cidr, 
('2018-5-'||(i%4)+16)::date,
(i%4+61)::numeric(8,2),
(i%4+61)::float8,
inet ('192.168.100.'||(i%4+61)),
i%4+61::int4,
interval '24 hours',
macaddr ('12:34:56:78:90:'||(i%4+61)::text)::text::macaddr,
(i%4+61)::text::money,
(i%4+61)::float4,
i%4+61,
i%4+61,
'aa'||(i%4+61)::text,
('01:00:'||(i%4)::text)::time,
('01:00:'||(i%4)::text||' EST')::timetz,
('2018-01-01 '||'01:00:'||(i%4)::text)::timestamp,
('2018-01-01 '||'01:00:'||(i%4)::text||' EST')::timestamptz,
('11111111-1111-1111-1111-1111111111'||(i%4+6)::text||(i%4+6)::text)::uuid,
('foo'||(i%4+61)::text||' & rat'||(i%4+61)::text)::tsquery,
(get_input_fields(i)).*
FROM generate_series(1,8) i;
INSERT INTO foo 
SELECT
i,
i%3+3,
i::bigint,
i,
i::bit,
(i)::bit(10)::bit varying(10),
(i)::bool,
(i)::char,
('a'||(i))::varchar(10),
('192.168.100.'||(i))::cidr, 
('2018-'||(i%12)+1||'-'||(i%15)+1)::date,
(i)::numeric(8,2),
(i)::float8,
inet ('192.168.100.'||(i)),
i::int4,
interval '24 hours',
macaddr ('12:34:56:78:90:'||(i)::text)::text::macaddr,
(i)::text::money,
(i)::float4,
i,
i,
'aa'||(i)::text,
('12:'||(i%60)::text||':'||(i%30)::text)::time,
('12:'||(i%60)::text||':'||(i%30)::text||' EST')::timetz,
('2018-01-01 '||'12:'||(i%60)::text||':'||(i%30)::text)::timestamp,
('2018-01-01 '||'12:'||(i%60)::text||':'||(i%30)::text||' EST')::timestamptz,
('11111111-1111-1111-1111-1111111111'||(i%10)::text||(i%10)::text)::uuid,
('foo'||(i)::text||' & rat'||(i)::text)::tsquery,
(get_input_fields(i)).*
FROM generate_series(1,10) i;
ANALYZE foo;
SELECT tablename, attname, null_frac, n_distinct, most_common_vals, most_common_freqs, histogram_bounds FROM pg_stats WHERE tablename like 'foo%' and attname != 'a' ORDER BY attname,tablename;
-- Test merging leaf stats where HLL is empty
DROP TABLE IF EXISTS foo;
CREATE TABLE foo (a int, b int, c text) PARTITION BY RANGE (b) (START (0) END (6) EVERY (3));
INSERT INTO foo select i, i%6, repeat('aaaa', 100000) FROM generate_series(1, 100)i;
ANALYZE foo;
SELECT schemaname, tablename, attname, null_frac, avg_width, n_distinct FROM pg_stats WHERE tablename like 'foo%' and attname = 'c' ORDER BY attname,tablename;
-- Test ANALYZE auto merge behavior
-- Do not merge stats from only one partition while other partitions have not been analyzed yet
DROP TABLE IF EXISTS foo;
CREATE TABLE foo (a int, b int, c int) PARTITION BY RANGE (b) (START (0) END (6) EVERY (3));
INSERT INTO foo SELECT i, i%6, i%6 FROM generate_series(1,100)i; 
ANALYZE foo_1_prt_1;
SELECT tablename, attname, null_frac, n_distinct, most_common_vals, most_common_freqs, histogram_bounds FROM pg_stats WHERE tablename like 'foo%' ORDER BY attname,tablename;

-- Merge stats from both partitions
DROP TABLE IF EXISTS foo;
CREATE TABLE foo (a int, b int, c int) PARTITION BY RANGE (b) (START (0) END (6) EVERY (3));
INSERT INTO foo SELECT i, i%6, i%6 FROM generate_series(1,100)i; 
ANALYZE foo_1_prt_1;
ANALYZE foo_1_prt_2;
SELECT tablename, attname, null_frac, n_distinct, most_common_vals, most_common_freqs, histogram_bounds FROM pg_stats WHERE tablename like 'foo%' ORDER BY attname,tablename;

-- No stats after merging 
DROP TABLE IF EXISTS foo;
CREATE TABLE foo (a int, b int, c int) PARTITION BY RANGE (b) (START (0) END (6) EVERY (3));
ANALYZE foo_1_prt_1;
ANALYZE foo_1_prt_2;
SELECT tablename, attname, null_frac, n_distinct, most_common_vals, most_common_freqs, histogram_bounds FROM pg_stats WHERE tablename like 'foo%' ORDER BY attname,tablename;

-- Merge stats from only one partition
DROP TABLE IF EXISTS foo;
CREATE TABLE foo (a int, b int, c int) PARTITION BY RANGE (b) (START (0) END (6) EVERY (3));
INSERT INTO foo SELECT i, i%6, i%6 FROM generate_series(1,100)i; 
SET allow_system_table_mods = 'DML';
UPDATE pg_attribute SET attstattarget=0 WHERE attrelid = 'foo_1_prt_1'::regclass and ATTNAME in ('a','b','c');
ANALYZE foo_1_prt_1;
ANALYZE foo_1_prt_2;
SELECT tablename, attname, null_frac, n_distinct, most_common_vals, most_common_freqs, histogram_bounds FROM pg_stats WHERE tablename like 'foo%' ORDER BY attname,tablename;

-- Merge stats from only one partition one column
DROP TABLE IF EXISTS foo;
CREATE TABLE foo (a int, b int, c int) PARTITION BY RANGE (b) (START (0) END (6) EVERY (3));
INSERT INTO foo SELECT i, i%6, i%6 FROM generate_series(1,100)i; 
ANALYZE foo_1_prt_1(c);
SELECT tablename, attname, null_frac, n_distinct, most_common_vals, most_common_freqs, histogram_bounds FROM pg_stats WHERE tablename like 'foo%' ORDER BY attname,tablename;

-- Test merging of stats for a newly added partition
-- Do not collect samples while merging stats
DROP TABLE IF EXISTS foo;
CREATE TABLE foo (a int, b int) PARTITION BY RANGE (b) (START (0) END (6) EVERY (3));
INSERT INTO FOO SELECT i,i%6 FROM generate_series(1,1000)i;
SET default_statistics_target = 4;
ANALYZE foo;
ALTER TABLE foo ADD partition new_part START (6) INCLUSIVE END (9) EXCLUSIVE;
INSERT INTO foo SELECT i, i%3+6 FROM generate_series(1,500)i;
ANALYZE foo_1_prt_new_part;
SET log_statement='none';
SET client_min_messages = 'log';
-- Insert a new column that is not analyzed in the leaf partitions.
-- Analyzing root partition will use merging statistics for the first 2 columns, 
-- will create a sample for the root to analyze the newly added columns since 
-- the leaf partitions does not have any stats for it, yet
ALTER TABLE foo ADD COLUMN c int;
INSERT INTO foo SELECT i, i%9, i%100 FROM generate_series(1,500)i;
ANALYZE rootpartition foo;
-- Testing auto merging root statistics for all columns
-- where column attnums are differents due to dropped columns
-- and split partitions.
DROP TABLE IF EXISTS foo;
CREATE TABLE foo (a int, b int, c text, d int)
	DISTRIBUTED BY (d) 
	PARTITION BY RANGE (a) 
		(START (0) END (8) EVERY (4), 
		DEFAULT PARTITION def_part);
INSERT INTO foo SELECT i%13, i, 'something'||i::text, i%121 FROM generate_series(1,1000)i;
ALTER TABLE foo DROP COLUMN b;
ALTER TABLE foo SPLIT DEFAULT PARTITION START (8) END (12) INTO (PARTITION new_part, default PARTITION);
set client_min_messages to 'log';
ANALYZE foo_1_prt_2;
ANALYZE foo_1_prt_3;
ANALYZE foo_1_prt_new_part;
ANALYZE foo_1_prt_def_part;
reset client_min_messages;
SELECT tablename, attname, null_frac, n_distinct, most_common_vals, most_common_freqs, histogram_bounds FROM pg_stats WHERE tablename like 'foo%' ORDER BY attname,tablename;
-- Testing auto merging root statistics for a column whose attnum
-- is aligned and the same in every partition due to dropped columns
-- and split partitions.
DROP TABLE IF EXISTS foo;
CREATE TABLE foo (a int, b int, c text, d int)
	DISTRIBUTED BY (d) 
	PARTITION BY RANGE (a) 
		(START (0) END (8) EVERY (4), 
		DEFAULT PARTITION def_part);
INSERT INTO foo SELECT i%13, i, 'something'||i::text, i%121 FROM generate_series(1,1000)i;
ALTER TABLE foo DROP COLUMN b;
ALTER TABLE foo SPLIT DEFAULT PARTITION START (8) END (12) INTO (PARTITION new_part, default PARTITION);
set client_min_messages to 'log';
ANALYZE foo_1_prt_2(a);
ANALYZE foo_1_prt_3(a);
ANALYZE foo_1_prt_new_part(a);
ANALYZE foo_1_prt_def_part(a);
reset client_min_messages;
SELECT tablename, attname, null_frac, n_distinct, most_common_vals, most_common_freqs, histogram_bounds FROM pg_stats WHERE tablename like 'foo%' ORDER BY attname,tablename;
-- Testing auto merging root statistics for a column whose attnum
-- is not aligned and different in partitions due to dropped columns
-- and split partitions.
DROP TABLE IF EXISTS foo;
CREATE TABLE foo (a int, b int, c text, d int)
	DISTRIBUTED BY (d) 
	PARTITION BY RANGE (a) 
		(START (0) END (8) EVERY (4), 
		DEFAULT PARTITION def_part);
INSERT INTO foo SELECT i%13, i, 'something'||i::text, i%121 FROM generate_series(1,1000)i;
ALTER TABLE foo DROP COLUMN b;
ALTER TABLE foo SPLIT DEFAULT PARTITION START (8) END (12) INTO (PARTITION new_part, default PARTITION);
set client_min_messages to 'log';
ANALYZE foo_1_prt_2(d);
ANALYZE foo_1_prt_3(d);
ANALYZE foo_1_prt_new_part(d);
ANALYZE foo_1_prt_def_part(d);
reset client_min_messages;
SELECT tablename, attname, null_frac, n_distinct, most_common_vals, most_common_freqs, histogram_bounds FROM pg_stats WHERE tablename like 'foo%' ORDER BY attname,tablename;
-- Testing ANALYZE ROOTPARTITION and when optimizer_analyze_root_partition is off
-- for incremental analyze.
DROP TABLE IF EXISTS foo;
CREATE TABLE foo (a int, b int, c text)
	PARTITION BY RANGE (b) 
		(START (0) END (8) EVERY (4));
INSERT INTO foo SELECT i%130, i%8, 'something'||i::text FROM generate_series(1,1000)i;
set optimizer_analyze_root_partition=off;
set client_min_messages to 'log';
-- ANALYZE ROOTPARTITION will sample the table and compute statistics since there
-- is not stats to be merged in the leaf partitions
ANALYZE ROOTPARTITION foo;
reset client_min_messages;
SELECT tablename, attname, null_frac, n_distinct, most_common_vals, most_common_freqs, histogram_bounds FROM pg_stats WHERE tablename like 'foo%' ORDER BY attname,tablename;
ANALYZE foo_1_prt_1;
ANALYZE foo_1_prt_2;
set client_min_messages to 'log';
-- ANALYZE ROOT PARTITION will piggyback on the stats collected from the leaf and merge them
ANALYZE ROOTPARTITION foo;
reset client_min_messages;
reset optimizer_analyze_root_partition;
SELECT tablename, attname, null_frac, n_distinct, most_common_vals, most_common_freqs, histogram_bounds FROM pg_stats WHERE tablename like 'foo%' ORDER BY attname,tablename;
-- Testing that auto merge will be disabled when optimizer_analyze_root_partition
-- is off for incremental analyze. 
DROP TABLE IF EXISTS foo;
CREATE TABLE foo (a int, b int, c text)
	PARTITION BY RANGE (b) 
		(START (0) END (8) EVERY (4));
INSERT INTO foo SELECT i%130, i%8, 'something'||i::text FROM generate_series(1,1000)i;
set optimizer_analyze_root_partition=off;
ANALYZE foo_1_prt_1;
ANALYZE foo_1_prt_2;
SELECT tablename, attname, null_frac, n_distinct, most_common_vals, most_common_freqs, histogram_bounds FROM pg_stats WHERE tablename like 'foo%' ORDER BY attname,tablename;
reset optimizer_analyze_root_partition;
-- Test incremental analyze on a partitioned table with different storage type and compression algorithm
DROP TABLE IF EXISTS incr_analyze_test;
CREATE TABLE incr_analyze_test (
    a integer,
    b character varying,
    c date
)
WITH (appendonly=true, compresslevel=5, orientation=row, compresstype=zlib) DISTRIBUTED BY (a) PARTITION BY RANGE(c)
          (
          START ('2018-01-01'::date) END ('2018-01-02'::date) EVERY ('1 day'::interval) WITH (tablename='incr_analyze_test_1_prt_1', appendonly=true, compresslevel=3, orientation=column, compresstype=ZLIB ),
          START ('2018-01-02'::date) END ('2018-01-03'::date) EVERY ('1 day'::interval) WITH (tablename='incr_analyze_test_1_prt_2', appendonly=true, compresslevel=1, orientation=column, compresstype=RLE_TYPE ),
          START ('2018-01-03'::date) END ('2018-01-04'::date) EVERY ('1 day'::interval) WITH (tablename='incr_analyze_test_1_prt_3', appendonly=true, compresslevel=1, orientation=column, compresstype=QUICKLZ ),
          START ('2018-01-04'::date) END ('2018-01-05'::date) EVERY ('1 day'::interval) WITH (tablename='incr_analyze_test_1_prt_4', appendonly=true, compresslevel=1, orientation=row, compresstype=ZLIB ),
          START ('2018-01-05'::date) END ('2018-01-06'::date) EVERY ('1 day'::interval) WITH (tablename='incr_analyze_test_1_prt_5', appendonly=true, compresslevel=1, orientation=row, compresstype=QUICKLZ ),
          START ('2018-01-06'::date) END ('2018-01-07'::date) EVERY ('1 day'::interval) WITH (tablename='incr_analyze_test_1_prt_6', appendonly=false)
          );

INSERT INTO incr_analyze_test VALUES (1, 'a', '2018-01-01');
ANALYZE incr_analyze_test;
SELECT tablename, attname, null_frac, n_distinct, most_common_vals, most_common_freqs, histogram_bounds FROM pg_stats WHERE tablename like 'incr_analyze_test%' ORDER BY attname,tablename;
INSERT INTO incr_analyze_test SELECT s, md5(s::varchar), '2018-01-02' FROM generate_series(1, 1000) AS s;
ANALYZE incr_analyze_test_1_prt_2;
SELECT tablename, attname, null_frac, n_distinct, most_common_vals, most_common_freqs, histogram_bounds FROM pg_stats WHERE tablename like 'incr_analyze_test%' ORDER BY attname,tablename;
SELECT relname, relpages, reltuples FROM pg_class WHERE relname LIKE 'incr_analyze_test%' ORDER BY relname;

-- start_ignore
DROP TABLE IF EXISTS t900c;
CREATE TABLE t900c (
 a int,
 b int,
 c1 text,
 c2 text,
 c3 text,
 c4 text,
 c5 text,
 c6 text,
 c7 text,
 c8 text,
 c9 text,
 c10 text,
 c11 text,
 c12 text,
 c13 text,
 c14 text,
 c15 text,
 c16 text,
 c17 text,
 c18 text,
 c19 text,
 c20 text,
 c21 text,
 c22 text,
 c23 text,
 c24 text,
 c25 text,
 c26 text,
 c27 text,
 c28 text,
 c29 text,
 c30 text,
 c31 text,
 c32 text,
 c33 text,
 c34 text,
 c35 text,
 c36 text,
 c37 text,
 c38 text,
 c39 text,
 c40 text,
 c41 text,
 c42 text,
 c43 text,
 c44 text,
 c45 text,
 c46 text,
 c47 text,
 c48 text,
 c49 text,
 c50 text,
 c51 text,
 c52 text,
 c53 text,
 c54 text,
 c55 text,
 c56 text,
 c57 text,
 c58 text,
 c59 text,
 c60 text,
 c61 text,
 c62 text,
 c63 text,
 c64 text,
 c65 text,
 c66 text,
 c67 text,
 c68 text,
 c69 text,
 c70 text,
 c71 text,
 c72 text,
 c73 text,
 c74 text,
 c75 text,
 c76 text,
 c77 text,
 c78 text,
 c79 text,
 c80 text,
 c81 text,
 c82 text,
 c83 text,
 c84 text,
 c85 text,
 c86 text,
 c87 text,
 c88 text,
 c89 text,
 c90 text,
 c91 text,
 c92 text,
 c93 text,
 c94 text,
 c95 text,
 c96 text,
 c97 text,
 c98 text,
 c99 text,
 c100 varchar(100),
 c101 varchar(100),
 c102 varchar(100),
 c103 varchar(100),
 c104 varchar(100),
 c105 varchar(100),
 c106 varchar(100),
 c107 varchar(100),
 c108 varchar(100),
 c109 varchar(100),
 c110 varchar(100),
 c111 varchar(100),
 c112 varchar(100),
 c113 varchar(100),
 c114 varchar(100),
 c115 varchar(100),
 c116 varchar(100),
 c117 varchar(100),
 c118 varchar(100),
 c119 varchar(100),
 c120 varchar(100),
 c121 varchar(100),
 c122 varchar(100),
 c123 varchar(100),
 c124 varchar(100),
 c125 varchar(100),
 c126 varchar(100),
 c127 varchar(100),
 c128 varchar(100),
 c129 varchar(100),
 c130 varchar(100),
 c131 varchar(100),
 c132 varchar(100),
 c133 varchar(100),
 c134 varchar(100),
 c135 varchar(100),
 c136 varchar(100),
 c137 varchar(100),
 c138 varchar(100),
 c139 varchar(100),
 c140 varchar(100),
 c141 varchar(100),
 c142 varchar(100),
 c143 varchar(100),
 c144 varchar(100),
 c145 varchar(100),
 c146 varchar(100),
 c147 varchar(100),
 c148 varchar(100),
 c149 varchar(100),
 c150 varchar(100),
 c151 varchar(100),
 c152 varchar(100),
 c153 varchar(100),
 c154 varchar(100),
 c155 varchar(100),
 c156 varchar(100),
 c157 varchar(100),
 c158 varchar(100),
 c159 varchar(100),
 c160 varchar(100),
 c161 varchar(100),
 c162 varchar(100),
 c163 varchar(100),
 c164 varchar(100),
 c165 varchar(100),
 c166 varchar(100),
 c167 varchar(100),
 c168 varchar(100),
 c169 varchar(100),
 c170 varchar(100),
 c171 varchar(100),
 c172 varchar(100),
 c173 varchar(100),
 c174 varchar(100),
 c175 varchar(100),
 c176 varchar(100),
 c177 varchar(100),
 c178 varchar(100),
 c179 varchar(100),
 c180 varchar(100),
 c181 varchar(100),
 c182 varchar(100),
 c183 varchar(100),
 c184 varchar(100),
 c185 varchar(100),
 c186 varchar(100),
 c187 varchar(100),
 c188 varchar(100),
 c189 varchar(100),
 c190 varchar(100),
 c191 varchar(100),
 c192 varchar(100),
 c193 varchar(100),
 c194 varchar(100),
 c195 varchar(100),
 c196 varchar(100),
 c197 varchar(100),
 c198 varchar(100),
 c199 varchar(100),
 c200 char(10),
 c201 char(10),
 c202 char(10),
 c203 char(10),
 c204 char(10),
 c205 char(10),
 c206 char(10),
 c207 char(10),
 c208 char(10),
 c209 char(10),
 c210 char(10),
 c211 char(10),
 c212 char(10),
 c213 char(10),
 c214 char(10),
 c215 char(10),
 c216 char(10),
 c217 char(10),
 c218 char(10),
 c219 char(10),
 c220 char(10),
 c221 char(10),
 c222 char(10),
 c223 char(10),
 c224 char(10),
 c225 char(10),
 c226 char(10),
 c227 char(10),
 c228 char(10),
 c229 char(10),
 c230 char(10),
 c231 char(10),
 c232 char(10),
 c233 char(10),
 c234 char(10),
 c235 char(10),
 c236 char(10),
 c237 char(10),
 c238 char(10),
 c239 char(10),
 c240 char(10),
 c241 char(10),
 c242 char(10),
 c243 char(10),
 c244 char(10),
 c245 char(10),
 c246 char(10),
 c247 char(10),
 c248 char(10),
 c249 char(10),
 c250 char(10),
 c251 char(10),
 c252 char(10),
 c253 char(10),
 c254 char(10),
 c255 char(10),
 c256 char(10),
 c257 char(10),
 c258 char(10),
 c259 char(10),
 c260 char(10),
 c261 char(10),
 c262 char(10),
 c263 char(10),
 c264 char(10),
 c265 char(10),
 c266 char(10),
 c267 char(10),
 c268 char(10),
 c269 char(10),
 c270 char(10),
 c271 char(10),
 c272 char(10),
 c273 char(10),
 c274 char(10),
 c275 char(10),
 c276 char(10),
 c277 char(10),
 c278 char(10),
 c279 char(10),
 c280 char(10),
 c281 char(10),
 c282 char(10),
 c283 char(10),
 c284 char(10),
 c285 char(10),
 c286 char(10),
 c287 char(10),
 c288 char(10),
 c289 char(10),
 c290 char(10),
 c291 char(10),
 c292 char(10),
 c293 char(10),
 c294 char(10),
 c295 char(10),
 c296 char(10),
 c297 char(10),
 c298 char(10),
 c299 bytea,
 c300 bytea,
 c301 bytea,
 c302 bytea,
 c303 bytea,
 c304 bytea,
 c305 bytea,
 c306 bytea,
 c307 bytea,
 c308 bytea,
 c309 bytea,
 c310 bytea,
 c311 bytea,
 c312 bytea,
 c313 bytea,
 c314 bytea,
 c315 bytea,
 c316 bytea,
 c317 bytea,
 c318 bytea,
 c319 bytea,
 c320 bytea,
 c321 bytea,
 c322 bytea,
 c323 bytea,
 c324 bytea,
 c325 bytea,
 c326 bytea,
 c327 bytea,
 c328 bytea,
 c329 bytea,
 c330 bytea,
 c331 bytea,
 c332 bytea,
 c333 bytea,
 c334 bytea,
 c335 bytea,
 c336 bytea,
 c337 bytea,
 c338 bytea,
 c339 bytea,
 c340 bytea,
 c341 bytea,
 c342 bytea,
 c343 bytea,
 c344 bytea,
 c345 bytea,
 c346 bytea,
 c347 bytea,
 c348 bytea,
 c349 bytea,
 c350 bytea,
 c351 bytea,
 c352 bytea,
 c353 bytea,
 c354 bytea,
 c355 bytea,
 c356 bytea,
 c357 bytea,
 c358 bytea,
 c359 bytea,
 c360 bytea,
 c361 bytea,
 c362 bytea,
 c363 bytea,
 c364 bytea,
 c365 bytea,
 c366 bytea,
 c367 bytea,
 c368 bytea,
 c369 bytea,
 c370 bytea,
 c371 bytea,
 c372 bytea,
 c373 bytea,
 c374 bytea,
 c375 bytea,
 c376 bytea,
 c377 bytea,
 c378 bytea,
 c379 bytea,
 c380 bytea,
 c381 bytea,
 c382 bytea,
 c383 bytea,
 c384 bytea,
 c385 bytea,
 c386 bytea,
 c387 bytea,
 c388 bytea,
 c389 bytea,
 c390 bytea,
 c391 bytea,
 c392 bytea,
 c393 bytea,
 c394 bytea,
 c395 bytea,
 c396 bytea,
 c397 bytea,
 c398 bytea,
 c399 bytea,
 c400 text,
 c401 text,
 c402 text,
 c403 text,
 c404 text,
 c405 text,
 c406 text,
 c407 text,
 c408 text,
 c409 text,
 c410 text,
 c411 text,
 c412 text,
 c413 text,
 c414 text,
 c415 text,
 c416 text,
 c417 text,
 c418 text,
 c419 text,
 c420 text,
 c421 text,
 c422 text,
 c423 text,
 c424 text,
 c425 text,
 c426 text,
 c427 text,
 c428 text,
 c429 text,
 c430 text,
 c431 text,
 c432 text,
 c433 text,
 c434 text,
 c435 text,
 c436 text,
 c437 text,
 c438 text,
 c439 text,
 c440 text,
 c441 text,
 c442 text,
 c443 text,
 c444 text,
 c445 text,
 c446 text,
 c447 text,
 c448 text,
 c449 text,
 c450 text,
 c451 text,
 c452 text,
 c453 text,
 c454 text,
 c455 text,
 c456 text,
 c457 text,
 c458 text,
 c459 text,
 c460 text,
 c461 text,
 c462 text,
 c463 text,
 c464 text,
 c465 text,
 c466 text,
 c467 text,
 c468 text,
 c469 text,
 c470 text,
 c471 text,
 c472 text,
 c473 text,
 c474 text,
 c475 text,
 c476 text,
 c477 text,
 c478 text,
 c479 text,
 c480 text,
 c481 text,
 c482 text,
 c483 text,
 c484 text,
 c485 text,
 c486 text,
 c487 text,
 c488 text,
 c489 text,
 c490 text,
 c491 text,
 c492 text,
 c493 text,
 c494 text,
 c495 text,
 c496 text,
 c497 text,
 c498 text,
 c499 text,
 c500 text,
 c501 text,
 c502 text,
 c503 text,
 c504 text,
 c505 text,
 c506 text,
 c507 text,
 c508 text,
 c509 text,
 c510 text,
 c511 text,
 c512 text,
 c513 text,
 c514 text,
 c515 text,
 c516 text,
 c517 text,
 c518 text,
 c519 text,
 c520 text,
 c521 text,
 c522 text,
 c523 text,
 c524 text,
 c525 text,
 c526 text,
 c527 text,
 c528 text,
 c529 text,
 c530 text,
 c531 text,
 c532 text,
 c533 text,
 c534 text,
 c535 text,
 c536 text,
 c537 text,
 c538 text,
 c539 text,
 c540 text,
 c541 text,
 c542 text,
 c543 text,
 c544 text,
 c545 text,
 c546 text,
 c547 text,
 c548 text,
 c549 text,
 c550 text,
 c551 text,
 c552 text,
 c553 text,
 c554 text,
 c555 text,
 c556 text,
 c557 text,
 c558 text,
 c559 text,
 c560 text,
 c561 text,
 c562 text,
 c563 text,
 c564 text,
 c565 text,
 c566 text,
 c567 text,
 c568 text,
 c569 text,
 c570 text,
 c571 text,
 c572 text,
 c573 text,
 c574 text,
 c575 text,
 c576 text,
 c577 text,
 c578 text,
 c579 text,
 c580 text,
 c581 text,
 c582 text,
 c583 text,
 c584 text,
 c585 text,
 c586 text,
 c587 text,
 c588 text,
 c589 text,
 c590 text,
 c591 text,
 c592 text,
 c593 text,
 c594 text,
 c595 text,
 c596 text,
 c597 text,
 c598 text,
 c599 text,
 c600 text,
 c601 text,
 c602 text,
 c603 text,
 c604 text,
 c605 text,
 c606 text,
 c607 text,
 c608 text,
 c609 text,
 c610 text,
 c611 text,
 c612 text,
 c613 text,
 c614 text,
 c615 text,
 c616 text,
 c617 text,
 c618 text,
 c619 text,
 c620 text,
 c621 text,
 c622 text,
 c623 text,
 c624 text,
 c625 text,
 c626 text,
 c627 text,
 c628 text,
 c629 text,
 c630 text,
 c631 text,
 c632 text,
 c633 text,
 c634 text,
 c635 text,
 c636 text,
 c637 text,
 c638 text,
 c639 text,
 c640 text,
 c641 text,
 c642 text,
 c643 text,
 c644 text,
 c645 text,
 c646 text,
 c647 text,
 c648 text,
 c649 text,
 c650 text,
 c651 text,
 c652 text,
 c653 text,
 c654 text,
 c655 text,
 c656 text,
 c657 text,
 c658 text,
 c659 text,
 c660 text,
 c661 text,
 c662 text,
 c663 text,
 c664 text,
 c665 text,
 c666 text,
 c667 text,
 c668 text,
 c669 text,
 c670 text,
 c671 text,
 c672 text,
 c673 text,
 c674 text,
 c675 text,
 c676 text,
 c677 text,
 c678 text,
 c679 text,
 c680 text,
 c681 text,
 c682 text,
 c683 text,
 c684 text,
 c685 text,
 c686 text,
 c687 text,
 c688 text,
 c689 text,
 c690 text,
 c691 text,
 c692 text,
 c693 text,
 c694 text,
 c695 text,
 c696 text,
 c697 text,
 c698 text,
 c699 text,
 c700 text,
 c701 text,
 c702 text,
 c703 text,
 c704 text,
 c705 text,
 c706 text,
 c707 text,
 c708 text,
 c709 text,
 c710 text,
 c711 text,
 c712 text,
 c713 text,
 c714 text,
 c715 text,
 c716 text,
 c717 text,
 c718 text,
 c719 text,
 c720 text,
 c721 text,
 c722 text,
 c723 text,
 c724 text,
 c725 text,
 c726 text,
 c727 text,
 c728 text,
 c729 text,
 c730 text,
 c731 text,
 c732 text,
 c733 text,
 c734 text,
 c735 text,
 c736 text,
 c737 text,
 c738 text,
 c739 text,
 c740 text,
 c741 text,
 c742 text,
 c743 text,
 c744 text,
 c745 text,
 c746 text,
 c747 text,
 c748 text,
 c749 text,
 c750 text,
 c751 text,
 c752 text,
 c753 text,
 c754 text,
 c755 text,
 c756 text,
 c757 text,
 c758 text,
 c759 text,
 c760 text,
 c761 text,
 c762 text,
 c763 text,
 c764 text,
 c765 text,
 c766 text,
 c767 text,
 c768 text,
 c769 text,
 c770 text,
 c771 text,
 c772 text,
 c773 text,
 c774 text,
 c775 text,
 c776 text,
 c777 text,
 c778 text,
 c779 text,
 c780 text,
 c781 text,
 c782 text,
 c783 text,
 c784 text,
 c785 text,
 c786 text,
 c787 text,
 c788 text,
 c789 text,
 c790 text,
 c791 text,
 c792 text,
 c793 text,
 c794 text,
 c795 text,
 c796 text,
 c797 text,
 c798 text,
 c799 text,
 c800 text,
 c801 text,
 c802 text,
 c803 text,
 c804 text,
 c805 text,
 c806 text,
 c807 text,
 c808 text,
 c809 text,
 c810 text,
 c811 text,
 c812 text,
 c813 text,
 c814 text,
 c815 text,
 c816 text,
 c817 text,
 c818 text,
 c819 text,
 c820 text,
 c821 text,
 c822 text,
 c823 text,
 c824 text,
 c825 text,
 c826 text,
 c827 text,
 c828 text,
 c829 text,
 c830 text,
 c831 text,
 c832 text,
 c833 text,
 c834 text,
 c835 text,
 c836 text,
 c837 text,
 c838 text,
 c839 text,
 c840 text,
 c841 text,
 c842 text,
 c843 text,
 c844 text,
 c845 text,
 c846 text,
 c847 text,
 c848 text,
 c849 text,
 c850 text,
 c851 text,
 c852 text,
 c853 text,
 c854 text,
 c855 text,
 c856 text,
 c857 text,
 c858 text,
 c859 text,
 c860 text,
 c861 text,
 c862 text,
 c863 text,
 c864 text,
 c865 text,
 c866 text,
 c867 text,
 c868 text,
 c869 text,
 c870 text,
 c871 text,
 c872 text,
 c873 text,
 c874 text,
 c875 text,
 c876 text,
 c877 text,
 c878 text,
 c879 text,
 c880 text,
 c881 text,
 c882 text,
 c883 text,
 c884 text,
 c885 text,
 c886 text,
 c887 text,
 c888 text,
 c889 text,
 c890 text,
 c891 text,
 c892 text,
 c893 text,
 c894 text,
 c895 text,
 c896 text,
 c897 text,
 c898 text,
 c899 text,
 c900 text)
	PARTITION BY RANGE (b) 
		(START (0) END (8) EVERY (4));
-- end_ignore
INSERT INTO t900c SELECT i%130, i%8, 'something'||i::text FROM generate_series(1,100)i;
ANALYZE t900c;
